#include "lexer.hpp"
#include <iostream>
#include <chrono>
#include <string>
#include <vector>
#include <cstdint>
#include <unordered_map>

using namespace jcc;

// Function to measure performance
void yourFunctionToMeasure()
{
    // Code of the function you want to measure
    // ...
}

static std::string program = "I2luY2x1ZGUgImxleGVyLmhwcCIKI2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8c2V0PgojaW5jbHVkZSA8c3RyaW5nPgojaW5jbHVkZSA8dmVjdG9yPgojaW5jbHVkZSA8Y3N0cmluZz4KI2luY2x1ZGUgPHJlZ2V4PgojaW5jbHVkZSA8c3N0cmVhbT4KI2luY2x1ZGUgPGNtYXRoPgoKLy8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8vIGpjYzo6VG9rZW4gY2xhc3MgaW1wbGVtZW50YXRpb24KLy8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCnN0YXRpYyBzdGQ6Om1hcDxpbnQsIHN0ZDo6c3RyaW5nPiB0b2tlblR5cGVNYXAgPSB7CiAgICB7LTEsICJ1bmtub3duIn0sCiAgICB7MCwgImlkZW50aWZpZXIifSwKICAgIHsxLCAia2V5d29yZCJ9LAogICAgezIsICJudW1iZXJfbGl0ZXJhbCJ9LAogICAgezMsICJzdHJpbmdfbGl0ZXJhbCJ9LAogICAgezQsICJvcGVyYXRvciJ9LAogICAgezUsICJwdW5jdHVhdG9yIn0sCiAgICB7NiwgIm11bHRpTGluZV9jb21tZW50In0sCiAgICB7NywgInNpbmdsZUxpbmVfY29tbWVudCJ9LAogICAgezgsICJ3aGl0ZXNwYWNlIn0sCn07CgpqY2M6OlRva2VuOjpUb2tlbigpCnsKICAgIG1fdHlwZSA9IGpjYzo6VG9rZW5UeXBlOjpVbmtub3duOwogICAgbV92YWx1ZSA9ICIiOwp9CgpqY2M6OlRva2VuOjpUb2tlbihqY2M6OlRva2VuVHlwZSB0eXBlLCBjb25zdCBzdGQ6OnN0cmluZyAmdmFsdWUpCnsKICAgIG1fdHlwZSA9IHR5cGU7CiAgICBtX3ZhbHVlID0gdmFsdWU7Cn0KCmpjYzo6VG9rZW5UeXBlIGpjYzo6VG9rZW46OnR5cGUoKSBjb25zdAp7CiAgICByZXR1cm4gbV90eXBlOwp9Cgpjb25zdCBzdGQ6OnN0cmluZyAmamNjOjpUb2tlbjo6dmFsdWUoKSBjb25zdAp7CiAgICByZXR1cm4gbV92YWx1ZTsKfQoKc3RkOjpzdHJpbmcgamNjOjpUb2tlbjo6dG9fc3RyaW5nKCkgY29uc3QKewogICAgc3dpdGNoICh0aGlzLT5tX3R5cGUpCiAgICB7CiAgICBjYXNlIFRva2VuVHlwZTo6SWRlbnRpZmllcjoKICAgICAgICByZXR1cm4gc3RkOjpzdHJpbmcoIklkZW50aWZpZXIoXCIiICsgbV92YWx1ZSArICJcIikiKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgVG9rZW5UeXBlOjpLZXl3b3JkOgogICAgICAgIHJldHVybiBzdGQ6OnN0cmluZygiS2V5d29yZCgiICsgbV92YWx1ZSArICIpIik7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIFRva2VuVHlwZTo6TnVtYmVyTGl0ZXJhbDoKICAgICAgICByZXR1cm4gc3RkOjpzdHJpbmcoIk51bWJlckxpdGVyYWwoIiArIG1fdmFsdWUgKyAiKSIpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSBUb2tlblR5cGU6OlN0cmluZ0xpdGVyYWw6CiAgICAgICAgcmV0dXJuIHN0ZDo6c3RyaW5nKCJTdHJpbmdMaXRlcmFsKFwiIiArIG1fdmFsdWUgKyAiXCIpIik7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIFRva2VuVHlwZTo6T3BlcmF0b3I6CiAgICAgICAgcmV0dXJuIHN0ZDo6c3RyaW5nKCJPcGVyYXRvcignIiArIG1fdmFsdWUgKyAiJykiKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgVG9rZW5UeXBlOjpQdW5jdHVhdG9yOgogICAgICAgIHJldHVybiBzdGQ6OnN0cmluZygiUHVuY3R1YXRvcignIiArIG1fdmFsdWUgKyAiJykiKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgVG9rZW5UeXBlOjpTaW5nbGVMaW5lQ29tbWVudDoKICAgICAgICByZXR1cm4gc3RkOjpzdHJpbmcoIlNpbmdsZUxpbmVDb21tZW50KFwiIiArIG1fdmFsdWUgKyAiXCIpIik7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIFRva2VuVHlwZTo6TXVsdGlMaW5lQ29tbWVudDoKICAgICAgICByZXR1cm4gc3RkOjpzdHJpbmcoIk11bHRpTGluZUNvbW1lbnQoXCIiICsgbV92YWx1ZSArICJcIikiKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgVG9rZW5UeXBlOjpXaGl0ZXNwYWNlOgogICAgICAgIHJldHVybiBzdGQ6OnN0cmluZygiV2hpdGVzcGFjZSgiICsgbV92YWx1ZSArICIpIik7CiAgICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBzdGQ6OnN0cmluZygiVW5rbm93bigiICsgbV92YWx1ZSArICIpIik7CiAgICAgICAgYnJlYWs7CiAgICB9Cn0KCi8vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vLyBqY2M6OlRva2VuTGlzdCBjbGFzcyBpbXBsZW1lbnRhdGlvbgovLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKamNjOjpUb2tlbkxpc3Q6OlRva2VuTGlzdCgpCnsKICAgIHRoaXMtPm1fdG9rZW5zID0gc3RkOjp2ZWN0b3I8VG9rZW4+KCk7CiAgICB0aGlzLT5tX2xvY2tlZCA9IGZhbHNlOwp9CgpqY2M6OlRva2VuTGlzdDo6VG9rZW5MaXN0KGNvbnN0IHN0ZDo6dmVjdG9yPGpjYzo6VG9rZW4+ICZ0b2tlbnMpCnsKICAgIHRoaXMtPm1fdG9rZW5zID0gdG9rZW5zOwogICAgdGhpcy0+bV9sb2NrZWQgPSBmYWxzZTsKfQoKdm9pZCBqY2M6OlRva2VuTGlzdDo6cHVzaF9iYWNrKGNvbnN0IGpjYzo6VG9rZW4gJnRva2VuKQp7CiAgICBpZiAodGhpcy0+bV9sb2NrZWQpCiAgICB7CiAgICAgICAgdGhyb3cgc3RkOjpydW50aW1lX2Vycm9yKCJVbmFibGUgdG8gcHVzaF9iYWNrIHRvIFRva2VuTGlzdCwgaXQgaXMgbG9ja2VkIik7CiAgICB9CgogICAgbV90b2tlbnMucHVzaF9iYWNrKHRva2VuKTsKfQoKdm9pZCBqY2M6OlRva2VuTGlzdDo6cHVzaF9iYWNrKGNvbnN0IHN0ZDo6dmVjdG9yPGpjYzo6VG9rZW4+ICZ0b2tlbnMpCnsKICAgIGlmICh0aGlzLT5tX2xvY2tlZCkKICAgIHsKICAgICAgICB0aHJvdyBzdGQ6OnJ1bnRpbWVfZXJyb3IoIlVuYWJsZSB0byBwdXNoX2JhY2sgdmVjdG9yIHRvIFRva2VuTGlzdCwgaXQgaXMgbG9ja2VkIik7CiAgICB9CgogICAgbV90b2tlbnMuaW5zZXJ0KG1fdG9rZW5zLmVuZCgpLCB0b2tlbnMuYmVnaW4oKSwgdG9rZW5zLmVuZCgpKTsKfQoKdm9pZCBqY2M6OlRva2VuTGlzdDo6bG9jaygpCnsKICAgIHRoaXMtPm1fbG9ja2VkID0gdHJ1ZTsKfQoKYm9vbCBqY2M6OlRva2VuTGlzdDo6aXNfbG9ja2VkKCkgY29uc3QKewogICAgcmV0dXJuIHRoaXMtPm1fbG9ja2VkOwp9Cgpjb25zdCBzdGQ6OnZlY3RvcjxqY2M6OlRva2VuPiAmamNjOjpUb2tlbkxpc3Q6OnRva2VucygpIGNvbnN0CnsKICAgIHJldHVybiB0aGlzLT5tX3Rva2VuczsKfQoKc3RkOjpzdHJpbmcgamNjOjpUb2tlbkxpc3Q6OnRvX3N0cmluZygpIGNvbnN0CnsKICAgIHN0ZDo6c3RyaW5nIHJlc3VsdCA9ICJUb2tlbkxpc3QoIjsKCiAgICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IG1fdG9rZW5zLnNpemUoKTsgaSsrKQogICAgewogICAgICAgIGlmIChtX3Rva2Vuc1tpXS50eXBlKCkgPT0gVG9rZW5UeXBlOjpXaGl0ZXNwYWNlIHx8IG1fdG9rZW5zW2ldLnR5cGUoKSA9PSBUb2tlblR5cGU6OlNpbmdsZUxpbmVDb21tZW50IHx8IG1fdG9rZW5zW2ldLnR5cGUoKSA9PSBUb2tlblR5cGU6Ok11bHRpTGluZUNvbW1lbnQpCiAgICAgICAgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ICs9IG1fdG9rZW5zW2ldLnRvX3N0cmluZygpOwoKICAgICAgICBpZiAoaSAhPSBtX3Rva2Vucy5zaXplKCkgLSAxKQogICAgICAgIHsKICAgICAgICAgICAgcmVzdWx0ICs9ICIsICI7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQgKyAiKSI7Cn0KCnN0ZDo6c3RyaW5nIGpjYzo6VG9rZW5MaXN0Ojp0b19qc29uKCkgY29uc3QKewogICAgc3RkOjpzdHJpbmcgcmVzdWx0ID0gIlsiOwogICAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCBtX3Rva2Vucy5zaXplKCk7IGkrKykKICAgIHsKICAgICAgICBpZiAobV90b2tlbnNbaV0udHlwZSgpID09IFRva2VuVHlwZTo6V2hpdGVzcGFjZSB8fCBtX3Rva2Vuc1tpXS50eXBlKCkgPT0gVG9rZW5UeXBlOjpTaW5nbGVMaW5lQ29tbWVudCB8fCBtX3Rva2Vuc1tpXS50eXBlKCkgPT0gVG9rZW5UeXBlOjpNdWx0aUxpbmVDb21tZW50KQogICAgICAgIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBzdGQ6OnN0cmluZyBlc2NhcGVkU3RyaW5nOwogICAgICAgIHJlc3VsdCArPSAieyI7CiAgICAgICAgcmVzdWx0ICs9ICJcInRcIjpcIiIgKyB0b2tlblR5cGVNYXBbc3RhdGljX2Nhc3Q8aW50PihtX3Rva2Vuc1tpXS50eXBlKCkpXSArICJcIiwiOwoKICAgICAgICBmb3IgKHNpemVfdCBqID0gMDsgaiA8IG1fdG9rZW5zW2ldLnZhbHVlKCkubGVuZ3RoKCk7IGorKykKICAgICAgICB7CiAgICAgICAgICAgIHN3aXRjaCAobV90b2tlbnNbaV0udmFsdWUoKVtqXSkKICAgICAgICAgICAgewogICAgICAgICAgICBjYXNlICdcbic6CiAgICAgICAgICAgICAgICBlc2NhcGVkU3RyaW5nICs9ICJcXG4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ1x0JzoKICAgICAgICAgICAgICAgIGVzY2FwZWRTdHJpbmcgKz0gIlxcdCI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnXHInOgogICAgICAgICAgICAgICAgZXNjYXBlZFN0cmluZyArPSAiXFxyIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdcMCc6CiAgICAgICAgICAgICAgICBlc2NhcGVkU3RyaW5nICs9ICJcXDAiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ1xcJzoKICAgICAgICAgICAgICAgIGVzY2FwZWRTdHJpbmcgKz0gIlxcXFwiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJyInOgogICAgICAgICAgICAgICAgZXNjYXBlZFN0cmluZyArPSAiXFxcIiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGVzY2FwZWRTdHJpbmcgKz0gbV90b2tlbnNbaV0udmFsdWUoKVtqXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgKz0gIlwidlwiOlwiIiArIGVzY2FwZWRTdHJpbmcgKyAiXCIiOwoKICAgICAgICByZXN1bHQgKz0gIn0iOwoKICAgICAgICBpZiAoaSAhPSBtX3Rva2Vucy5zaXplKCkgLSAxKQogICAgICAgIHsKICAgICAgICAgICAgcmVzdWx0ICs9ICIsIjsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0ICsgIl0iOwp9Cgpjb25zdCBqY2M6OlRva2VuICZqY2M6OlRva2VuTGlzdDo6b3BlcmF0b3JbXShzaXplX3QgaW5kZXgpIGNvbnN0CnsKICAgIHJldHVybiBtX3Rva2Vucy5hdChpbmRleCk7Cn0KCnZvaWQgamNjOjpUb2tlbkxpc3Q6OnBvcF9mcm9udCgpCnsKICAgIGlmICh0aGlzLT5tX2xvY2tlZCkKICAgIHsKICAgICAgICB0aHJvdyBzdGQ6OnJ1bnRpbWVfZXJyb3IoIlVuYWJsZSB0byBwb3BfZnJvbnQgZnJvbSBUb2tlbkxpc3QsIGl0IGlzIGxvY2tlZCIpOwogICAgfQoKICAgIG1fdG9rZW5zLmVyYXNlKG1fdG9rZW5zLmJlZ2luKCkpOwp9CgpzaXplX3QgamNjOjpUb2tlbkxpc3Q6OnNpemUoKSBjb25zdAp7CiAgICByZXR1cm4gbV90b2tlbnMuc2l6ZSgpOwp9CgovLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLy8gamNjOjpMZXhlciBjbGFzcyBpbXBsZW1lbnRhdGlvbgovLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZW51bSBjbGFzcyBMZXhlclN0YXRlCnsKICAgIERlZmF1bHQsCiAgICBTdHJpbmdMaXRlcmFsLAogICAgTnVtYmVyTGl0ZXJhbCwKICAgIFNpbmdsZUxpbmVDb21tZW50LAogICAgTXVsdGlMaW5lQ29tbWVudCwKICAgIElkZW50aWZpZXIsCiAgICBPcGVyYXRvciwKICAgIFB1bmN0dWF0b3IsCiAgICBXaGl0ZXNwYWNlCn07CgplbnVtIGNsYXNzIExleGVyU3RhdGVNb2RpZmllcgp7CiAgICBOb25lLAogICAgU3RyaW5nRXNjYXBlLAogICAgU3RyaW5nU2luZ2xlUXVvdGUsCiAgICBTdHJpbmdTaW5nbGVRdW90ZUVzY2FwZQp9OwoKc3RhdGljIHN0ZDo6dmVjdG9yPHN0ZDo6c3RyaW5nPiBsZXhTZXBlcmF0b3JzID0gewogICAgIigiLCAgLy8gbGVmdCBwYXJlbnRoZXNpcwogICAgIikiLCAgLy8gcmlnaHQgcGFyZW50aGVzaXMKICAgICJ7IiwgIC8vIGxlZnQgYnJhY2UKICAgICJ9IiwgIC8vIHJpZ2h0IGJyYWNlCiAgICAiWyIsICAvLyBsZWZ0IGJyYWNrZXQKICAgICJdIiwgIC8vIHJpZ2h0IGJyYWNrZXQKICAgICI7IiwgIC8vIHNlbWljb2xvbgogICAgIiwiLCAgLy8gY29tbWEKICAgICI6OiIsIC8vIHNjb3BlIHJlc29sdXRpb24KICAgICI6IiwgIC8vIGNvbG9uCn07CgpzdGF0aWMgc3RkOjp2ZWN0b3I8c3RkOjpzdHJpbmc+IGxleE9wZXJhdG9ycyA9IHsKICAgICIrPSIsICAvLyBwbHVzIGVxdWFscwogICAgIi09IiwgIC8vIG1pbnVzIGVxdWFscwogICAgIio9IiwgIC8vIHRpbWVzIGVxdWFscwogICAgIi89IiwgIC8vIGZsb2F0aW5nIGRpdmlkZSBlcXVhbHMKICAgICIlPSIsICAvLyBtb2R1bHVzIGVxdWFscwogICAgIi8vPSIsIC8vIGZsb29yIGRpdmlkZSBlcXVhbHMKCiAgICAiXl49IiwgIC8vIHhvciBlcXVhbHMKICAgICJ8fD0iLCAgLy8gb3IgZXF1YWxzCiAgICAiJiY9IiwgIC8vIGFuZCBlcXVhbHMKICAgICI8PD0iLCAgLy8gbGVmdCBzaGlmdCBlcXVhbHMKICAgICI+Pj0iLCAgLy8gYXJpdGhtZXRpYyByaWdodCBzaGlmdCBlcXVhbHMKICAgICI+Pj49IiwgLy8gdW5zaWduZWQgcmlnaHQgc2hpZnQgZXF1YWxzCiAgICAifD0iLCAgIC8vIGJpdHdpc2Ugb3IgZXF1YWxzCiAgICAiJj0iLCAgIC8vIGJpdHdpc2UgYW5kIGVxdWFscwogICAgIl49IiwgICAvLyBiaXR3aXNlIHhvciBlcXVhbHMKCiAgICAiPDwiLCAvLyBsZWZ0IHNoaWZ0CiAgICAiPj4iLCAvLyByaWdodCBzaGlmdAogICAgIj09IiwgLy8gZXF1YWxzCiAgICAiIT0iLCAvLyBub3QgZXF1YWxzCiAgICAiJiYiLCAvLyBhbmQKICAgICJ8fCIsIC8vIG9yCiAgICAiXl4iLCAvLyB4b3IKICAgICI8PSIsIC8vIGxlc3MgdGhhbiBvciBlcXVhbAogICAgIj49IiwgLy8gZ3JlYXRlciB0aGFuIG9yIGVxdWFsCiAgICAiPCIsICAvLyBsZXNzIHRoYW4KICAgICI+IiwgIC8vIGdyZWF0ZXIgdGhhbgoKICAgICI9IiwgLy8gYXNzaWduCiAgICAiPz8iLAogICAgIkAiLAoKICAgICIvLyIsIC8vIGZsb29yIGRpdmlkZQogICAgIisrIiwgLy8gaW5jcmVtZW50CiAgICAiLS0iLCAvLyBkZWNyZW1lbnQKICAgICIrIiwgIC8vIHBsdXMKICAgICItIiwgIC8vIG1pbnVzCiAgICAiKiIsICAvLyB0aW1lcwogICAgIi8iLCAgLy8gZmxvYXRpbmcgZGl2aWRlCiAgICAiJSIsICAvLyBtb2R1bHVzCiAgICAiJiIsICAvLyBiaXR3aXNlIGFuZAogICAgInwiLCAgLy8gYml0d2lzZSBvcgogICAgIl4iLCAgLy8gYml0d2lzZSB4b3IKICAgICJ+IiwgIC8vIGJpdHdpc2Ugbm90CiAgICAiISIsICAvLyBub3QKCiAgICAiPyIsICAgICAgLy8gdGVybmFyeQogICAgIiMiLCAgICAgIC8vIHByZXByb2Nlc3NvcgogICAgIi4iLCAgICAgIC8vIG1lbWJlciBhY2Nlc3MKICAgICIsIiwgICAgICAvLyBjb21tYQogICAgIm5ldyIsICAgIC8vIGR5bmFtaWMgYWxsb2NhdGlvbgogICAgImRlbGV0ZSIsIC8vIGR5bmFtaWMgZGVhbGxvY2F0aW9uCn07CgpzdGF0aWMgc3RkOjpzZXQ8c3RkOjpzdHJpbmc+IGxleEtleXdvcmRzID0gewogICAgIm5hbWVtYXAiLAogICAgIm5hbWVzcGFjZSIsCiAgICAidXNpbmciLAogICAgImV4cG9ydCIsCiAgICAiZ2xvYmFsIiwKICAgICJpbmZlciIsCiAgICAic2VhbCIsCiAgICAidW5zZWFsIiwKICAgICJjbGFzcyIsCiAgICAic3RydWN0IiwKICAgICJ1bmlvbiIsCiAgICAidHlwZWRlZiIsCiAgICAicHVibGljIiwKICAgICJwcml2YXRlIiwKICAgICJwcm90ZWN0ZWQiLAogICAgImNsYWltIiwKICAgICJ2aXJ0dWFsIiwKICAgICJhYnN0cmFjdCIsCiAgICAidm9sYXRpbGUiLAogICAgImNvbnN0IiwKICAgICJlbnVtIiwKICAgICJzdGF0aWNfbWFwIiwKICAgICJleHBsaWNpdCIsCiAgICAiZXh0ZXJuIiwKICAgICJmcmllbmQiLAogICAgIm9wZXJhdG9yIiwKICAgICJ0aGlzIiwKICAgICJjb25zdHJ1Y3RvciIsCiAgICAiZGVzdHJ1Y3RvciIsCiAgICAibWV0YWNsYXNzIiwKICAgICJtZXRhdHlwZSIsCiAgICAibWV0YWZ1bmN0aW9uIiwKICAgICJtZXRhIiwKICAgICJzaXplb2YiLAogICAgImlmIiwKICAgICJlbHNlIiwKICAgICJmb3IiLAogICAgIndoaWxlIiwKICAgICJkbyIsCiAgICAic3dpdGNoIiwKICAgICJyZXR1cm4iLAogICAgImZhdWx0IiwKICAgICJjYXNlIiwKICAgICJicmVhayIsCiAgICAiZGVmYXVsdCIsCiAgICAiYWJvcnQiLAogICAgInRocm93IiwKICAgICJjb250aW51ZSIsCiAgICAiaW50biIsCiAgICAidWludG4iLAogICAgImZsb2F0IiwKICAgICJkb3VibGUiLAogICAgImludCIsCiAgICAic2lnbmVkIiwKICAgICJ1bnNpZ25lZCIsCiAgICAibG9uZyIsCiAgICAiYm9vbCIsCiAgICAiYml0IiwKICAgICJjaGFyIiwKICAgICJ2b2lkIiwKICAgICJhdXRvIn07CgpzdGF0aWMgY29uc3QgY2hhciBsZXhJZGVudGlmaWVyQ2hhcnNbXSA9ICJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OV8iOwpzdGF0aWMgY29uc3Qgc2l6ZV90IGxleElkZW50aWZpZXJDaGFyc0xlbmd0aCA9IChzaXplb2YobGV4SWRlbnRpZmllckNoYXJzKSAtIDEpIC8gc2l6ZW9mKGNoYXIpOwoKZW51bSBjbGFzcyBOdW1iZXJMaXRlcmFsVHlwZQp7CiAgICBJbnZhbGlkLAogICAgRGVjaW1hbCwKICAgIEhleGFkZWNpbWFsLAogICAgQmluYXJ5LAogICAgT2N0YWwsCiAgICBGbG9hdGluZywKfTsKCnN0YXRpYyBOdW1iZXJMaXRlcmFsVHlwZSBjaGVja19udW1iZXJfbGl0ZXJhbF90eXBlKHN0ZDo6c3RyaW5nIGlucHV0KQp7CiAgICAvLyBudW1iZXIgZm9ybWF0czoKICAgIC8vIDB4QWJEMTAsIC0weEFiRDEwCiAgICAvLyAwYjEwMTAxMDAwMTAsIC0wYjEwMTAxMDAwMTAKICAgIC8vIDBvMTIzNDU2NywgLTBvMTIzNDU2NwogICAgLy8gMTIzNDU2Nzg5MCwgLTEyMzQ1Njc4OTAKICAgIC8vIDBkMTIzNDU2Nzg5MCwgLTBkMTIzNDU2Nzg5MAogICAgLy8gMS4yMzQ1Njc4OTBlMTAsIC0xLjIzNDU2Nzg5MGUxMAoKICAgIC8vIC8vIGNoZWNrIGZvciBoZXgKICAgIC8vIHJlZ2V4cEhleCA6PSByZWdleHAuTXVzdENvbXBpbGUoYF4weFswLTlhLWZBLUZdKyRgKQogICAgLy8gcmVnZXhwQmluYXJ5IDo9IHJlZ2V4cC5NdXN0Q29tcGlsZShgXjBiWzAxXSskYCkKICAgIC8vIHJlZ2V4cE9jdGFsIDo9IHJlZ2V4cC5NdXN0Q29tcGlsZShgXjBvWzAtN10rJGApCiAgICAvLyByZWdleHBEZWNpbWFsIDo9IHJlZ2V4cC5NdXN0Q29tcGlsZShgXlswLTldKyRgKQogICAgLy8gcmVnZXhwRGVjaW1hbEV4cGxpY2l0IDo9IHJlZ2V4cC5NdXN0Q29tcGlsZShgXjBkWzAtOV0rJGApCiAgICAvLyByZWdleHBGbG9hdCA6PSByZWdleHAuTXVzdENvbXBpbGUoYF4oWzAtOV0rKFwuWzAtOV0rKT8pPyhlWystXT8oWzAtOV0rKFwuP1swLTldKyk/KSspKiRgKQoKICAgIGF1dG8gcmVnZXhwSGV4ID0gc3RkOjpyZWdleCgiXjB4WzAtOWEtZkEtRl0rJCIpOwogICAgYXV0byByZWdleHBCaW5hcnkgPSBzdGQ6OnJlZ2V4KCJeMGJbMDFdKyQiKTsKICAgIGF1dG8gcmVnZXhwT2N0YWwgPSBzdGQ6OnJlZ2V4KCJeMG9bMC03XSskIik7CiAgICBhdXRvIHJlZ2V4cERlY2ltYWwgPSBzdGQ6OnJlZ2V4KCJeWzAtOV0rJCIpOwogICAgYXV0byByZWdleHBEZWNpbWFsRXhwbGljaXQgPSBzdGQ6OnJlZ2V4KCJeMGRbMC05XSskIik7CiAgICBhdXRvIHJlZ2V4cEZsb2F0ID0gc3RkOjpyZWdleCgiXihbMC05XSsoXFwuWzAtOV0rKT8pPyhlWystXT8oWzAtOV0rKFxcLj9bMC05XSspPykrKSokIik7CgogICAgaWYgKGlucHV0WzBdID09ICctJykKICAgIHsKICAgICAgICBpbnB1dCA9IGlucHV0LnN1YnN0cigxKTsKICAgIH0KCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChpbnB1dCwgcmVnZXhwSGV4KSkKICAgIHsKICAgICAgICByZXR1cm4gTnVtYmVyTGl0ZXJhbFR5cGU6OkhleGFkZWNpbWFsOwogICAgfQogICAgZWxzZSBpZiAoc3RkOjpyZWdleF9tYXRjaChpbnB1dCwgcmVnZXhwQmluYXJ5KSkKICAgIHsKICAgICAgICByZXR1cm4gTnVtYmVyTGl0ZXJhbFR5cGU6OkJpbmFyeTsKICAgIH0KICAgIGVsc2UgaWYgKHN0ZDo6cmVnZXhfbWF0Y2goaW5wdXQsIHJlZ2V4cE9jdGFsKSkKICAgIHsKICAgICAgICByZXR1cm4gTnVtYmVyTGl0ZXJhbFR5cGU6Ok9jdGFsOwogICAgfQogICAgZWxzZSBpZiAoc3RkOjpyZWdleF9tYXRjaChpbnB1dCwgcmVnZXhwRGVjaW1hbCkpCiAgICB7CiAgICAgICAgcmV0dXJuIE51bWJlckxpdGVyYWxUeXBlOjpEZWNpbWFsOwogICAgfQogICAgZWxzZSBpZiAoc3RkOjpyZWdleF9tYXRjaChpbnB1dCwgcmVnZXhwRGVjaW1hbEV4cGxpY2l0KSkKICAgIHsKICAgICAgICByZXR1cm4gTnVtYmVyTGl0ZXJhbFR5cGU6OkRlY2ltYWw7CiAgICB9CiAgICBlbHNlIGlmIChzdGQ6OnJlZ2V4X21hdGNoKGlucHV0LCByZWdleHBGbG9hdCkpCiAgICB7CiAgICAgICAgcmV0dXJuIE51bWJlckxpdGVyYWxUeXBlOjpGbG9hdGluZzsKICAgIH0KCiAgICByZXR1cm4gTnVtYmVyTGl0ZXJhbFR5cGU6OkludmFsaWQ7Cn0KCnZvaWQgbm9ybWFsaXplX251bWJlcl9saXRlcmFsKHN0ZDo6c3RyaW5nICZudW1iZXIsIHNpemVfdCBjb2x1bW4sIHNpemVfdCBsaW5lKQp7CiAgICB1aW50NjRfdCB2YWx1ZSA9IDA7CiAgICBzdGQ6OnN0cmluZ3N0cmVhbSBzczsKCiAgICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IG51bWJlci5sZW5ndGgoKTsgaSsrKQogICAgewogICAgICAgIG51bWJlcltpXSA9IHN0ZDo6dG9sb3dlcihudW1iZXJbaV0pOwogICAgfQoKICAgIE51bWJlckxpdGVyYWxUeXBlIHR5cGUgPSBjaGVja19udW1iZXJfbGl0ZXJhbF90eXBlKG51bWJlcik7CiAgICBpZiAodHlwZSA9PSBOdW1iZXJMaXRlcmFsVHlwZTo6SW52YWxpZCkKICAgIHsKICAgICAgICB0aHJvdyBqY2M6OkxleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIk51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICB9CgogICAgc3dpdGNoICh0eXBlKQogICAgewogICAgY2FzZSBOdW1iZXJMaXRlcmFsVHlwZTo6SGV4YWRlY2ltYWw6CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIE51bWJlckxpdGVyYWxUeXBlOjpCaW5hcnk6CiAgICAgICAgLy8gY29udmVydCBiaW5hcnkgc3RyaW5nIHRvIHVpbnQ2NF90CiAgICAgICAgZm9yIChzaXplX3QgaSA9IDI7IGkgPCBudW1iZXIubGVuZ3RoKCk7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBvdmVyZmxvdwogICAgICAgICAgICBpZiAodmFsdWUgJiAweDgwMDAwMDAwMDAwMDAwMDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IGpjYzo6TGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiQmluYXJ5IG51bWJlciBsaXRlcmFsIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pICsgIiBpcyB0b28gbGFyZ2UuIFdpbGwgbm90IGZpdCBpbiA2NCBiaXRzLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA8PCAxKSArIChudW1iZXJbaV0gLSAnMCcpOwogICAgICAgIH0KCiAgICAgICAgc3MgPDwgIjB4IiA8PCBzdGQ6OmhleCA8PCB2YWx1ZTsKICAgICAgICBudW1iZXIgPSBzcy5zdHIoKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgTnVtYmVyTGl0ZXJhbFR5cGU6Ok9jdGFsOgogICAgICAgIGZvciAoc2l6ZV90IGkgPSAyOyBpIDwgbnVtYmVyLmxlbmd0aCgpOyArK2kpCiAgICAgICAgewogICAgICAgICAgICAvLyBjaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICAgaWYgKHZhbHVlICYgMHhFMDAwMDAwMDAwMDAwMDAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aHJvdyBqY2M6OkxleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIk9jdGFsIG51bWJlciBsaXRlcmFsIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pICsgIiBpcyB0b28gbGFyZ2UuIFdpbGwgbm90IGZpdCBpbiA2NCBiaXRzLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA8PCAzKSArIChudW1iZXJbaV0gLSAnMCcpOwogICAgICAgIH0KICAgICAgICBzcyA8PCAiMHgiIDw8IHN0ZDo6aGV4IDw8IHZhbHVlOwogICAgICAgIG51bWJlciA9IHNzLnN0cigpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSBOdW1iZXJMaXRlcmFsVHlwZTo6RGVjaW1hbDoKICAgICAgICBicmVhazsKICAgIGNhc2UgTnVtYmVyTGl0ZXJhbFR5cGU6OkZsb2F0aW5nOgogICAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KfQoKLy8vIEBicmllZiBMZXggdGhlIHNvdXJjZSBjb2RlIGludG8gYSBsaXN0IG9mIHRva2VucwovLy8gQHBhcmFtIHNvdXJjZSBKWFggc291cmNlIGNvZGUgcmF3IHN0cmluZwovLy8gQHBhcmFtIHByZXByb2Nlc3MgV2hldGhlciB0byBwcmVwcm9jZXNzIHRoZSBzb3VyY2UgY29kZQovLy8gQHJldHVybiBBIHZlY3RvciBvZiB0b2tlbnMKLy8vIEBub3RlIFRoaXMgaXMgcHJvYmFibHkgdGhlIG1vc3QgY29tcGxleCBJIGhhdmUgZXZlciB3cml0dGVuLiBTbyBleHBlY3QgYnVncy4KamNjOjpUb2tlbkxpc3QgamNjOjpMZXhlcjo6bGV4KGNvbnN0IHN0ZDo6c3RyaW5nICZzb3VyY2UsIGJvb2wgcHJlcHJvY2VzcykKewogICAgLy8vIFRPRE86IGltcGxlbWVudAogICAgc3RkOjpzdHJpbmcgcHJlcHJvY2Vzc2VkID0gc291cmNlLCBjdXJyZW50X3Rva2VuID0gIiI7CiAgICBUb2tlbkxpc3QgcmVzdWx0OwogICAgTGV4ZXJTdGF0ZSBzdGF0ZSA9IExleGVyU3RhdGU6OkRlZmF1bHQ7CiAgICBMZXhlclN0YXRlTW9kaWZpZXIgbW9kaWZpZXIgPSBMZXhlclN0YXRlTW9kaWZpZXI6Ok5vbmU7CiAgICBzaXplX3QgaSA9IDAsIHNyY19sZW5ndGggPSAwLCBsaW5lID0gMSwgY29sdW1uID0gMTsKICAgIGJvb2wgZm91bmQgPSBmYWxzZTsKCiAgICBpZiAocHJlcHJvY2VzcykKICAgIHsKICAgICAgICBwcmVwcm9jZXNzZWQgKz0gIlxuIjsKICAgIH0KCiAgICBzcmNfbGVuZ3RoID0gcHJlcHJvY2Vzc2VkLmxlbmd0aCgpOwoKICAgIHdoaWxlIChpIDwgc3JjX2xlbmd0aCkKICAgIHsKICAgICAgICBjaGFyIGN1cnJlbnRfY2hhciA9IHByZXByb2Nlc3NlZFtpXTsKCiAgICAgICAgc3dpdGNoIChzdGF0ZSkKICAgICAgICB7CiAgICAgICAgY2FzZSBMZXhlclN0YXRlOjpEZWZhdWx0OgogICAgICAgICAgICAvLyBDaGVjayBmb3Igc2luZ2xlIGxpbmUgY29tbWVudAogICAgICAgICAgICBpZiAoc3JjX2xlbmd0aCAtIGkgPj0gMiAmJiBjdXJyZW50X2NoYXIgPT0gJy8nICYmIHByZXByb2Nlc3NlZFtpICsgMV0gPT0gJy8nKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IExleGVyU3RhdGU6OlNpbmdsZUxpbmVDb21tZW50OwogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgY29sdW1uKys7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIG11bHRpIGxpbmUgY29tbWVudAogICAgICAgICAgICBpZiAoc3JjX2xlbmd0aCAtIGkgPj0gMiAmJiBjdXJyZW50X2NoYXIgPT0gJy8nICYmIHByZXByb2Nlc3NlZFtpICsgMV0gPT0gJyonKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IExleGVyU3RhdGU6Ok11bHRpTGluZUNvbW1lbnQ7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBjb2x1bW4rKzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDaGVjayBmb3Igb3BlcmF0b3IKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhdXRvICZvcCA6IGxleE9wZXJhdG9ycykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHNyY19sZW5ndGggLSBpID49IG9wLmxlbmd0aCgpICYmIHByZXByb2Nlc3NlZC5zdWJzdHIoaSwgb3AubGVuZ3RoKCkpID09IG9wKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoX2JhY2soVG9rZW4oVG9rZW5UeXBlOjpPcGVyYXRvciwgb3ApKTsKICAgICAgICAgICAgICAgICAgICBpICs9IG9wLmxlbmd0aCgpIC0gMTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvdW5kKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLy8gQ2hlY2sgZm9yIFB1bmN0dWF0b3IKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhdXRvICZzZXAgOiBsZXhTZXBlcmF0b3JzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoc3JjX2xlbmd0aCAtIGkgPj0gc2VwLmxlbmd0aCgpICYmIHByZXByb2Nlc3NlZC5zdWJzdHIoaSwgc2VwLmxlbmd0aCgpKSA9PSBzZXApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2hfYmFjayhUb2tlbihUb2tlblR5cGU6OlB1bmN0dWF0b3IsIHNlcCkpOwogICAgICAgICAgICAgICAgICAgIGkgKz0gc2VwLmxlbmd0aCgpIC0gMTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvdW5kKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHN0cmluZyBsaXRlcmFscwogICAgICAgICAgICBpZiAoY3VycmVudF9jaGFyID09ICciJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpTdHJpbmdMaXRlcmFsOwogICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBMZXhlclN0YXRlTW9kaWZpZXI6Ok5vbmU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X2NoYXIgPT0gJ1wnJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpTdHJpbmdMaXRlcmFsOwogICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBMZXhlclN0YXRlTW9kaWZpZXI6OlN0cmluZ1NpbmdsZVF1b3RlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIGZvciBrZXl3b3JkCiAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoY29uc3QgYXV0byAma3cgOiBsZXhLZXl3b3JkcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHNyY19sZW5ndGggLSBpID49IGt3Lmxlbmd0aCgpICYmIHByZXByb2Nlc3NlZC5zdWJzdHIoaSwga3cubGVuZ3RoKCkpID09IGt3KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoX2JhY2soVG9rZW4oVG9rZW5UeXBlOjpLZXl3b3JkLCBrdykpOwogICAgICAgICAgICAgICAgICAgIGkgKz0ga3cubGVuZ3RoKCkgLSAxOwogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm91bmQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDaGVjayBmb3IgaWRlbnRpZmllcgogICAgICAgICAgICBpZiAoIXN0ZDo6aXNkaWdpdChjdXJyZW50X2NoYXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZm9yIChzaXplX3QgaiA9IDA7IGogPCBsZXhJZGVudGlmaWVyQ2hhcnNMZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudF9jaGFyID09IGxleElkZW50aWZpZXJDaGFyc1tqXSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGZvdW5kKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gTGV4ZXJTdGF0ZTo6SWRlbnRpZmllcjsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIG51bWJlciBsaXRlcmFsCiAgICAgICAgICAgIC8vLyBUT0RPOiBDaGVjayBmb3IgbnVtYmVyIGxpdGVyYWwKICAgICAgICAgICAgaWYgKChjdXJyZW50X2NoYXIgPj0gJzAnICYmIGN1cnJlbnRfY2hhciA8PSAnOScpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IExleGVyU3RhdGU6Ok51bWJlckxpdGVyYWw7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHdoaXRlc3BhY2UKICAgICAgICAgICAgaWYgKHN0ZDo6aXNzcGFjZShjdXJyZW50X2NoYXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IExleGVyU3RhdGU6OldoaXRlc3BhY2U7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW52YWxpZCBzdGF0ZQogICAgICAgICAgICB0aHJvdyBMZXhlckV4Y2VwdGlvblVuZXhwZWN0ZWQoIlVuZXhwZWN0ZWQgdG9rZW4gYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikgKyAiOiAnIiArIGN1cnJlbnRfY2hhciArICInOiAnIiArIGN1cnJlbnRfdG9rZW4gKyAiJyIpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXhlclN0YXRlOjpTdHJpbmdMaXRlcmFsOgogICAgICAgICAgICBpZiAoY3VycmVudF9jaGFyID09ICdcbicgfHwgc3JjX2xlbmd0aCAtIGkgPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiU3RyaW5nIGxpdGVyYWwgbm90IHRlcm1pbmF0ZWQuIEV4cGVjdGVkICdcIicgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobW9kaWZpZXIgPT0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdTaW5nbGVRdW90ZSB8fCBtb2RpZmllciA9PSBMZXhlclN0YXRlTW9kaWZpZXI6OlN0cmluZ1NpbmdsZVF1b3RlRXNjYXBlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAobW9kaWZpZXIgPT0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdTaW5nbGVRdW90ZUVzY2FwZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRfY2hhcikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbic6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gJ1xuJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAndCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gJ1x0JzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gJ1xyJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gJ1wwJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnXFwnOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9ICdcXCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdTaW5nbGVRdW90ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRfY2hhciA9PSAnXFwnKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdTaW5nbGVRdW90ZUVzY2FwZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRfY2hhciA9PSAnXCcnKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoX2JhY2soVG9rZW4oVG9rZW5UeXBlOjpTdHJpbmdMaXRlcmFsLCBjdXJyZW50X3Rva2VuKSk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gTGV4ZXJTdGF0ZTo6RGVmYXVsdDsKICAgICAgICAgICAgICAgICAgICBtb2RpZmllciA9IExleGVyU3RhdGVNb2RpZmllcjo6Tm9uZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICBpZiAobW9kaWZpZXIgPT0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdFc2NhcGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjdXJyZW50X2NoYXIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ24nOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9ICdcbic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9ICdcdCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3InOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9ICdccic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJzAnOgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9ICdcMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ1xcJzoKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiArPSAnXFwnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiArPSBjdXJyZW50X2NoYXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtb2RpZmllciA9IExleGVyU3RhdGVNb2RpZmllcjo6Tm9uZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRfY2hhciA9PSAnXFwnKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1vZGlmaWVyID0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdFc2NhcGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X2NoYXIgPT0gJyInKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoX2JhY2soVG9rZW4oVG9rZW5UeXBlOjpTdHJpbmdMaXRlcmFsLCBjdXJyZW50X3Rva2VuKSk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gTGV4ZXJTdGF0ZTo6RGVmYXVsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6Ok51bWJlckxpdGVyYWw6CiAgICAgICAgICAgIGlmICgoY3VycmVudF90b2tlbi5lbXB0eSgpIHx8IGN1cnJlbnRfdG9rZW4uc2l6ZSgpID09IDEpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIXN0ZDo6aXNkaWdpdChjdXJyZW50X2NoYXIpICYmIGN1cnJlbnRfY2hhciAhPSAnYicgJiYgY3VycmVudF9jaGFyICE9ICdvJyAmJiBjdXJyZW50X2NoYXIgIT0gJ3gnICYmIGN1cnJlbnRfY2hhciAhPSAnZCcpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRfdG9rZW4uc2l6ZSgpID4gMSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIk51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZmluaXNoX251bWJlcl9saXRlcmFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRfdG9rZW5bMF0pCiAgICAgICAgICAgIHsKICAgICAgICAgICAgY2FzZSAnMCc6CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudF90b2tlbi5zaXplKCkgPj0gMiAmJiBjdXJyZW50X3Rva2VuWzFdID09ICd4JykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGN1cnJlbnRfY2hhciA+PSAnMCcgJiYgY3VycmVudF9jaGFyIDw9ICc5JykgfHwgKGN1cnJlbnRfY2hhciA+PSAnYScgJiYgY3VycmVudF9jaGFyIDw9ICdmJykgfHwgKGN1cnJlbnRfY2hhciA+PSAnQScgJiYgY3VycmVudF9jaGFyIDw9ICdGJykpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudF90b2tlbi5sZW5ndGgoKSA9PSAyKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiSGV4YWRlY2ltYWwgbnVtYmVyIGxpdGVyYWwgbm90IHZhbGlkIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNhbG51bShjdXJyZW50X2NoYXIpIHx8IGN1cnJlbnRfY2hhciA9PSAnXycpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBMZXhlckV4Y2VwdGlvbkludmFsaWRMaXRlcmFsKCJIZXhhZGVjaW1hbCBudW1iZXIgbGl0ZXJhbCBub3QgdmFsaWQgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGZpbmlzaF9udW1iZXJfbGl0ZXJhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X3Rva2VuLnNpemUoKSA+PSAyICYmIGN1cnJlbnRfdG9rZW5bMV0gPT0gJ2InKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50X2NoYXIgPT0gJzAnIHx8IGN1cnJlbnRfY2hhciA9PSAnMScpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudF90b2tlbi5sZW5ndGgoKSA9PSAyKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiQmluYXJ5IG51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzYWxudW0oY3VycmVudF9jaGFyKSB8fCBjdXJyZW50X2NoYXIgPT0gJ18nKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiQmluYXJ5IG51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZmluaXNoX251bWJlcl9saXRlcmFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRfdG9rZW4uc2l6ZSgpID49IDIgJiYgY3VycmVudF90b2tlblsxXSA9PSAnbycpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRfY2hhciA+PSAnMCcgJiYgY3VycmVudF9jaGFyIDw9ICc3JykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gY3VycmVudF9jaGFyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X3Rva2VuLmxlbmd0aCgpID09IDIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBMZXhlckV4Y2VwdGlvbkludmFsaWRMaXRlcmFsKCJPY3RhbCBudW1iZXIgbGl0ZXJhbCBub3QgdmFsaWQgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc2FsbnVtKGN1cnJlbnRfY2hhcikgfHwgY3VycmVudF9jaGFyID09ICdfJykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIk9jdGFsIG51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZmluaXNoX251bWJlcl9saXRlcmFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRfdG9rZW4uc2l6ZSgpID49IDIgJiYgY3VycmVudF90b2tlblsxXSA9PSAnZCcpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRfY2hhciA+PSAnMCcgJiYgY3VycmVudF9jaGFyIDw9ICc5JykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gY3VycmVudF9jaGFyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50X3Rva2VuLmxlbmd0aCgpID09IDIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBMZXhlckV4Y2VwdGlvbkludmFsaWRMaXRlcmFsKCJEZWNpbWFsIG51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzYWxudW0oY3VycmVudF9jaGFyKSB8fCBjdXJyZW50X2NoYXIgPT0gJ18nKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiRGVjaW1hbCBudW1iZXIgbGl0ZXJhbCBub3QgdmFsaWQgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGZpbmlzaF9udW1iZXJfbGl0ZXJhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoY3VycmVudF9jaGFyID49ICcwJyAmJiBjdXJyZW50X2NoYXIgPD0gJzknKSB8fCBjdXJyZW50X2NoYXIgPT0gJy4nKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gY3VycmVudF9jaGFyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGdvdG8gZmluaXNoX251bWJlcl9saXRlcmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJzEnOgogICAgICAgICAgICBjYXNlICcyJzoKICAgICAgICAgICAgY2FzZSAnMyc6CiAgICAgICAgICAgIGNhc2UgJzQnOgogICAgICAgICAgICBjYXNlICc1JzoKICAgICAgICAgICAgY2FzZSAnNic6CiAgICAgICAgICAgIGNhc2UgJzcnOgogICAgICAgICAgICBjYXNlICc4JzoKICAgICAgICAgICAgY2FzZSAnOSc6CiAgICAgICAgICAgICAgICBpZiAoKGN1cnJlbnRfY2hhciA+PSAnMCcgJiYgY3VycmVudF9jaGFyIDw9ICc5JykgfHwgY3VycmVudF9jaGFyID09ICcuJyB8fCBjdXJyZW50X2NoYXIgPT0gJ2UnKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfdG9rZW4gKz0gY3VycmVudF9jaGFyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNhbG51bShjdXJyZW50X2NoYXIpIHx8IGN1cnJlbnRfY2hhciA9PSAnXycpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiTnVtYmVyIGxpdGVyYWwgbm90IHZhbGlkIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBnb3RvIGZpbmlzaF9udW1iZXJfbGl0ZXJhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiTnVtYmVyIGxpdGVyYWwgbm90IHZhbGlkIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZmluaXNoX251bWJlcl9saXRlcmFsOgogICAgICAgICAgICBub3JtYWxpemVfbnVtYmVyX2xpdGVyYWwoY3VycmVudF90b2tlbiwgY29sdW1uLCBsaW5lKTsKICAgICAgICAgICAgcmVzdWx0LnB1c2hfYmFjayhUb2tlbihUb2tlblR5cGU6Ok51bWJlckxpdGVyYWwsIGN1cnJlbnRfdG9rZW4pKTsKICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICBzdGF0ZSA9IExleGVyU3RhdGU6OkRlZmF1bHQ7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgTGV4ZXJTdGF0ZTo6U2luZ2xlTGluZUNvbW1lbnQ6CiAgICAgICAgICAgIGlmIChjdXJyZW50X2NoYXIgIT0gJ1xuJyB8fCBzcmNfbGVuZ3RoIC0gaSA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoX2JhY2soVG9rZW4oVG9rZW5UeXBlOjpTaW5nbGVMaW5lQ29tbWVudCwgY3VycmVudF90b2tlbikpOwogICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpEZWZhdWx0OwogICAgICAgICAgICAgICAgbGluZSsrOwogICAgICAgICAgICAgICAgY29sdW1uID0gMTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTGV4ZXJTdGF0ZTo6TXVsdGlMaW5lQ29tbWVudDoKICAgICAgICAgICAgaWYgKHNyY19sZW5ndGggLSBpID49IDIgJiYgY3VycmVudF9jaGFyID09ICcqJyAmJiBwcmVwcm9jZXNzZWRbaSArIDFdID09ICcvJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaSArPSAyOwogICAgICAgICAgICAgICAgY29sdW1uICs9IDI7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaF9iYWNrKFRva2VuKFRva2VuVHlwZTo6TXVsdGlMaW5lQ29tbWVudCwgY3VycmVudF90b2tlbikpOwogICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpEZWZhdWx0OwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6OklkZW50aWZpZXI6CiAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoc2l6ZV90IGogPSAwOyBqIDwgbGV4SWRlbnRpZmllckNoYXJzTGVuZ3RoOyBqKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50X2NoYXIgPT0gbGV4SWRlbnRpZmllckNoYXJzW2pdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaF9iYWNrKFRva2VuKFRva2VuVHlwZTo6SWRlbnRpZmllciwgY3VycmVudF90b2tlbikpOwogICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpEZWZhdWx0OwogICAgICAgICAgICAgICAgaS0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiArPSBjdXJyZW50X2NoYXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXhlclN0YXRlOjpPcGVyYXRvcjoKICAgICAgICAgICAgLyogY29kZSAqLwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6OlB1bmN0dWF0b3I6CiAgICAgICAgICAgIC8qIGNvZGUgKi8KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXhlclN0YXRlOjpXaGl0ZXNwYWNlOgogICAgICAgICAgICBpZiAoIXN0ZDo6aXNzcGFjZShjdXJyZW50X2NoYXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaF9iYWNrKFRva2VuKFRva2VuVHlwZTo6V2hpdGVzcGFjZSwgY3VycmVudF90b2tlbikpOwogICAgICAgICAgICAgICAgY3VycmVudF90b2tlbiA9ICIiOwogICAgICAgICAgICAgICAgc3RhdGUgPSBMZXhlclN0YXRlOjpEZWZhdWx0OwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjdXJyZW50X3Rva2VuICs9IGN1cnJlbnRfY2hhcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaGFuZGxlIG5ld2xpbmVzCiAgICAgICAgICAgIGlmIChjdXJyZW50X2NoYXIgPT0gJ1xuJykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbGluZSsrOwogICAgICAgICAgICAgICAgY29sdW1uID0gMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25VbmV4cGVjdGVkKCJMZXhlciBpbnZhbGlkIHN0YXRlIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaSsrOwogICAgICAgIGNvbHVtbisrOwogICAgfQoKICAgIGlmIChzdGF0ZSAhPSBMZXhlclN0YXRlOjpEZWZhdWx0KQogICAgewogICAgICAgIHN3aXRjaCAoc3RhdGUpCiAgICAgICAgewogICAgICAgIGNhc2UgTGV4ZXJTdGF0ZTo6U3RyaW5nTGl0ZXJhbDoKICAgICAgICAgICAgaWYgKG1vZGlmaWVyID09IExleGVyU3RhdGVNb2RpZmllcjo6U3RyaW5nU2luZ2xlUXVvdGUgfHwgbW9kaWZpZXIgPT0gTGV4ZXJTdGF0ZU1vZGlmaWVyOjpTdHJpbmdTaW5nbGVRdW90ZUVzY2FwZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgTGV4ZXJFeGNlcHRpb25JbnZhbGlkTGl0ZXJhbCgiU3RyaW5nIGxpdGVyYWwgbm90IHRlcm1pbmF0ZWQuIEV4cGVjdGVkIFwiJ1wiIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIlN0cmluZyBsaXRlcmFsIG5vdCB0ZXJtaW5hdGVkLiBFeHBlY3RlZCAnXCInIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6Ok51bWJlckxpdGVyYWw6CiAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZExpdGVyYWwoIk51bWJlciBsaXRlcmFsIG5vdCB2YWxpZCBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTGV4ZXJTdGF0ZTo6U2luZ2xlTGluZUNvbW1lbnQ6CiAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZCgiU2luZ2xlIGxpbmUgY29tbWVudCBub3QgdmFsaWQgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6Ok11bHRpTGluZUNvbW1lbnQ6CiAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZCgiTXVsdGkgbGluZSBjb21tZW50IG5vdCB0ZXJtaW5hdGVkLiBFeHBlY3RlZCAnKi8nIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXhlclN0YXRlOjpJZGVudGlmaWVyOgogICAgICAgICAgICB0aHJvdyBMZXhlckV4Y2VwdGlvbkludmFsaWRJZGVudGlmaWVyKCJJbnZhbGlkIGlkZW50aWZpZXIgXCIiICsgY3VycmVudF90b2tlbiArICJcIiBhdCBsaW5lICIgKyBzdGQ6OnRvX3N0cmluZyhsaW5lKSArICIsIGNvbHVtbiAiICsgc3RkOjp0b19zdHJpbmcoY29sdW1uKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTGV4ZXJTdGF0ZTo6T3BlcmF0b3I6CiAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZE9wZXJhdG9yKCJJbnZhbGlkIG9wZXJhdG9yIFwiIiArIGN1cnJlbnRfdG9rZW4gKyAiXCIgYXQgbGluZSAiICsgc3RkOjp0b19zdHJpbmcobGluZSkgKyAiLCBjb2x1bW4gIiArIHN0ZDo6dG9fc3RyaW5nKGNvbHVtbikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIExleGVyU3RhdGU6OlB1bmN0dWF0b3I6CiAgICAgICAgICAgIHRocm93IExleGVyRXhjZXB0aW9uSW52YWxpZFB1bmN0dWF0b3IoIkludmFsaWQgcHVuY3R1YXRvciBcIiIgKyBjdXJyZW50X3Rva2VuICsgIlwiIGF0IGxpbmUgIiArIHN0ZDo6dG9fc3RyaW5nKGxpbmUpICsgIiwgY29sdW1uICIgKyBzdGQ6OnRvX3N0cmluZyhjb2x1bW4pKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9";

std::unordered_map<char, int> base64_map = {
    {'A', 0}, {'B', 1}, {'C', 2}, {'D', 3}, {'E', 4}, {'F', 5}, {'G', 6}, {'H', 7}, {'I', 8}, {'J', 9}, {'K', 10}, {'L', 11}, {'M', 12}, {'N', 13}, {'O', 14}, {'P', 15}, {'Q', 16}, {'R', 17}, {'S', 18}, {'T', 19}, {'U', 20}, {'V', 21}, {'W', 22}, {'X', 23}, {'Y', 24}, {'Z', 25}, {'a', 26}, {'b', 27}, {'c', 28}, {'d', 29}, {'e', 30}, {'f', 31}, {'g', 32}, {'h', 33}, {'i', 34}, {'j', 35}, {'k', 36}, {'l', 37}, {'m', 38}, {'n', 39}, {'o', 40}, {'p', 41}, {'q', 42}, {'r', 43}, {'s', 44}, {'t', 45}, {'u', 46}, {'v', 47}, {'w', 48}, {'x', 49}, {'y', 50}, {'z', 51}, {'0', 52}, {'1', 53}, {'2', 54}, {'3', 55}, {'4', 56}, {'5', 57}, {'6', 58}, {'7', 59}, {'8', 60}, {'9', 61}, {'+', 62}, {'/', 63}};

std::string base64_decode(const std::string &input)
{
    std::string result;
    result.reserve(input.size() * 3 / 4);

    for (size_t i = 0; i < input.size(); i += 4)
    {
        uint32_t tmp = 0;
        for (size_t j = 0; j < 4; ++j)
        {
            if (input[i + j] != '=')
            {
                tmp |= base64_map[input[i + j]] << (18 - j * 6);
            }
        }
        for (size_t j = 0; j < 3; ++j)
        {
            if (input[i + j + 1] != '=')
            {
                result.push_back(static_cast<char>((tmp >> (16 - j * 8)) & 0xFF));
            }
        }
    }
    return result;
}

int main()
{
    // Start measuring time using the rdtsc instruction
    uint64_t start, end;
    jcc::TokenList list;
    std::vector<uint64_t> times;

    std::string raw = base64_decode(program);

    for (size_t i = 0; i < 400; i++)
    {
        start = 0;
        end = 0;
        start = std::chrono::duration_cast<std::chrono::nanoseconds>(std::chrono::high_resolution_clock::now().time_since_epoch()).count();

        // Call the function you want to measure
        list = Lexer::lex(raw);

        end = std::chrono::duration_cast<std::chrono::nanoseconds>(std::chrono::high_resolution_clock::now().time_since_epoch()).count();
        // Calculate the elapsed clock cycles
        times.push_back(end - start);
    }

    // Calculate the average clock cycles
    uint64_t sum = 0;
    for (auto &time : times)
    {
        sum += time;
    }

    double avg = sum / times.size();
    std::cout << "Total tokens: " << list.size() << std::endl;
    std::cout << "Overall: " << (uint64_t)avg << " ns" << std::endl;
    std::cout << "Avg compute time: " << avg / (raw.size() * 8) << " ns/bit" << std::endl;

    if (list.size() == 0)
    {
        std::cout << "Lexer failed" << std::endl;
        return 1;
    }

    std::cout << "Avg: " << avg / list.size() << " ns/token" << std::endl;

    return 0;
}